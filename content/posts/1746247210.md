+++
title = """Pleasanterのパートナーになったので早速社内の図書管理的な何かを作ってみる(貸出管理編) Vol.2"""
date = 2024-10-02T00:46:53.000Z
expiryDate = 2024-12-27T08:08:36.777Z
tags = ["vtj","devops"]
+++
前回の記事でテーブルを作って書籍情報を登録できるようになりました。  
Pleasanterでは色々なことができるようになるので、次のステップとして貸出管理機能を追加してみます。

[devops-blog.virtualtech.jp](https://devops-blog.virtualtech.jp/entry/20240930/1727658871)

プロセスとは？
=======

Pleasanterを使いこなしている方から「プロセス」を使って！とヒントを頂いたので、プロセスについて学んでみましょう。

プロセスは、よくあるいい方をすると稟議申請等に使う承認ワークフロー機能です。`状況による制御`機能と組み合わせることで項目の表示/非表示や読取専用などの細かい制御もできます。

[pleasanter.org](https://pleasanter.org/ja/manual/process)

動かしてみる
------

テーブルに関するあれこれは左端にある`ナビゲーションメニュー > 管理 > テーブルの管理`から表示します。少し画面レイアウトにも慣れてきましたね。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094736.png)

テーブルの管理ページが開けたら、タブの一覧から`プロセス`を選択します。今は何も登録していないので空っぽです。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094733.png)

一覧表の左上あたりの`新規作成`ボタンをクリックします。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094739.png)

プロセスの設定画面が表示されます。いろいろと設定項目はありますが、`全般`のみを変更してみて動きを確認します。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094742.png)

どんな項目がどんな役割か全くわからない状態だとどこを変更していいのか分からなかったので、ドキュメントを読みつつ変更してみる項目を決めてみました。

項目名

説明

設定例

名称

必須項目。内部的な名称。

貸出

表示名

実際に画面に表示される名称。

借りる

画面種別

`新規作成`と`編集`から選択可能。(アクション種別が`追加したボタンのみ`)

編集

現在の状況

プロセス管理対象とするステータス

\*(すべて)

変更後の状況

プロセス処理後に更新するステータス

\*(すべて)

ツールチップ

マウスカーソルを合わせた際に表示されるもの

図書を借りる申請

確認メッセージ

ボタンを押した後に表示される確認ダイアログ

借りたい図書は本棚から手元にありますか？

成功メッセージ

プロセス処理後に表示されるメッセージ

貸出申請しました

実行種別

プロセス機能を実行する方法設定

追加したボタン

アクション種別

プロセス機能で追加されたボタンのアクション種別を設定

保存

これらの項目をすべて設定したら、保存ボタンを押します。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094745.png)

何もなかったところに、先ほど作成したプロセスが追加されました。一覧画面の下にある`更新`ボタンを押します。これで先ほど追加したプロセスが反映されます。

`トップ > 図書管理 > (任意のレコード)`にアクセスして編集画面を表示します。すると先ほど追加した`借りる`ボタンが表示されます。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094751.png)

ボタンの部分を拡大するとこんな感じです。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094748.png)

ツールチップを知らない方にとっては何？と思うかもしれませんが、ボタンにマウスカーソルを合わせた際に表示されるものです。普段何気なく使っているけど、名前で言われるとピンのこない名前ですね。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094800.png)

他の項目も順に確認します。まずは、確認ダイアログです。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094757.png)

次に、サクセスメッセージ。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094754.png)

今回は、特に複雑なことはやってないので、通常の保存ボタンと同じような処理が実行されて終了します。

だいぶ、プロセス機能の雰囲気が掴めました。

貸出管理
====

今回やろうとしている図書管理に話を戻します。真面目に整理しようとすると色々と要件が出てきてブログとしては分かりにくくなりそうなので、ステータスに応じた制御くらいで留めておきます。

*   要件1: ステータスは、`貸出可能`、`申請中`、`貸出中`の3種類
*   要件2: `貸出可能`では、`借りる`ボタンが表示され、ボタンを押すとステータスが`申請中`に変更される
*   要件3: `申請中`では、アクセス権限が付与された人のみに`承認`ボタンが表示され、ボタンを押すとステータスが`貸出中`に変更される
*   要件4: `貸出中`では、`返す`ボタンが表示され、ボタンを押すとステータスが`貸出可能`に変更される

用件が整理できたらプロセスを組む前にステータスを整えて、要件1を満たしましょう。1回目の記事で作った時に`状況`のステータス一覧をデフォルトのままにしていたので、要件1に合うように変更します。

`ナビゲーションメニュー > 管理 > テーブルの管理 > エディタ > [図書管理] 状況`を`[図書管理] 貸出状況`に変えます。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094803.png)

ステータスの一覧も要件1に合うように変えました。ステータスの1行の書き方にはルールがあり、`{{値}},{表示名}},{{短縮名}}{{スタイル}}`の順番で記述します。今回は細かいところには拘らないので雰囲気を合わせて作ってみます。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094807.png)

そのまま使いたい方はこちらからコピー&ペーストしてください。

100,貸出可能,可,lent-possible
200,申請中,申,applying
300,貸出中,貸,lent-out

変えた後に`状況`の項目は特別な意味合いを持った項目だったようにも思い、別で用意した方が良かった？と少し悩んだのですが、今回は突き進みます。

状況ステータスは、選択肢に完了としての意味合いを持たせたりすることができるので、実際に使う際の設計時に気をつけるポイントですね。

> 値」が 900 以上のものは「完了」として扱われ、 900 未満のものは「未完了」として扱われます。

[pleasanter.org](https://pleasanter.org/ja/manual/table-management-status)

ステータスが整え終わったら最初に作ったプロセスに戻って`現在の状況`や`変更後の状況`で表示されるステータスが先ほど登録した内容に変わっているか確認します。

問題なく反映されていることが確認できたら、先程のステータスに画像のように設定して反映します。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094810.png)

今回はシンプルにしているので、`全般`のステータスを設定するだけで、ボタンの表示/非表示で制御できるようになりました。

同じような要領で`貸出承認`プロセスと`返却`プロセスも追加してみます。

プロセス名

現在の状況

変更後の状況

貸出

貸出可能

申請中

貸出承認

申請中

貸出中

返却

貸出中

貸出可能

プロセスの追加ができたら更新して、図書管理の一覧に戻ります。試しに変更してみるレコードを表示して、ボタンの表示を確認しながら貸出→申請→承認→返却の一連の流れを試してみます。

**貸出前**

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094819.png)

**申請後**

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094816.png)

**貸出後**

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094813.png)

ここまでスクリプトなどを組むことなく、画面の設定だけで実現することができました。

アクセス権限と承認者の指定
=============

テーブルに対して設定する`サイトのアクセス制御`の時と少しだけ振る舞いが違います。サイトのアクセス制御の時は、`すべてのユーザ`を指定しない限り、自分以外の誰も見ることができませんでした。

プロセスの権限は、何も設定していないと、すべてのユーザが使用可能な状態になります。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094822.png)

なので、特定の誰かだけ承認できるようにしたい時は、承認させたい人を指定することでその人のみが許可されるようになります。

![](https://cdn-ak.f.st-hatena.com/images/fotolife/v/virtualtech/20241002/20241002094825.png)

これで、承認は特定の誰かしかボタンが表示されないように変更することができます。

おわりに
====

実際の業務では、何らかの変更を加えるときに誰かの承認やチェックが必要な場合があります。その時の承認フローを気軽に組むことができて良いですね。スクリプトを書かずにどこまでできるのか、楽しみになってきました。

[[source]](https://devops-blog.virtualtech.jp/entry/20241002/1727830013)
